# Cache

### 캐시란?(메이플 캐시 아님)

컴퓨터 과학에서 데이터나 값을 미리 복사해 놓는 임시 메모리이다.

원래 데이터에 접근할 경우 시간이 오래걸릴 수 있고 또한 사용한 데이터를 또 사용할 때에도 유용하게 사용할 수 있다.

CPU칩 안에 같이 탑재되는 작은 메모리이며 접근속도가 매우 빠르다.

2~3개의 캐시메모리를 사용되며 속도와 크기에 따라 분류하고 L1먼저 사용하고 해당 캐시에서 못찾으면 L2캐시로 가는식으로 사용된다.

### 캐시의 지역성

* 속도가 빠른 저장장치와 느린 장치간의 속도차에 따른 병목현상을 줄이기 위한 메모리
* CPU가 어떤 데이터를 원할것인가를 예측할 수 있어야 한다.
* 이 예측을 위해 지역성의 원리를 따른다.

##### 시간지역성

* 최근에 접근한 데이터에 다시 접근하는 경향
* 반복문(for, while 같은) 사용시 한번 참조된 데이터는 또 참조될 가능성이 높다.

##### 공간 지역성

* A[0],A[1]같은 연속 접근 시 한번 참조된 데이터 근처에 있는 데이터가 잠시 후 또 사용될 가능성이 높은 경우

이런식으로 접근해서 Cache에 데이터가 있으면 Cache Hit 없으면 Cache Miss라고 한다.



### 캐시미스 3가지 경우

* Cold miss - 해당 메모리를 처음 불렀을때 나는 미스
* Conflict miss - 캐시에 A, B를 저장해야 하는 상황에서 A, B가 같은 주소에 할당되는 경우
* Capacity miss - 캐시 메모리 공간부족으로 생기는 미스 그렇다고 캐시 공간을 키우면 접근속도가 느려져 캐시를 쓰는 의미가 줄어든다

### 캐시의 구조 및 작동 방식

##### Direct Mapped Cache

* 가장 기본적인 구조
* DRAM의 여러 주소가 캐시메모리의 한 주소에 대응되는 다대일 방식
* 메모리 주소가 ABCD 방식이라면 캐시의 AB부분에 ABOO에 해당하는 데이터들을 가져오는 방식이다.
* AB부분에 나머지 부분인 태그필드와 그부분에 해당하는 데이터를 저장하는 데이터필드로 배치된다.
* 간단하고 빠르지만 위 캐시미스 3가지경우중 Conflict miss가 발생한다는 단점을 가지고 있다. ex) ABCC, ABCD를 보관하게 될 경우 ABCC에 ABCD를 덮어 씌움

##### Fully Associative Cache

* 캐시의 비어있는 부분에 주소를 저장하는 방식
* 저장할때는 매우 간단하지만, 캐시에서 데이터를 찾을 때 시간이 소요됨
* CAM이라는 특수한 메모리구조를 사용하지만 가겨이 매우 비싸다

##### Set Associative Cache

* Direct + Fully 방식 특정 행을 지정하고 해당 행에서 어떤 열이든 비어있다면 그곳에 저장하는 방식 저장속도, 데이터 검색속도 모두 위의 두 경우의 중간에 해당한다.





개인적으로 캐시는 알아두면 도움이 되긴 합니다. 코드를 짤때 캐시 히트를 했냐 안했냐에 따라서 실행시간이 크게 차이나는 경우가 많아서 유의해두고 코드를 짠다면 같은 알고리즘에 비슷한 방식으로 코드를 짜더라도 더 빠르게 실행되는 코드를 짤 수 있습니다. 

실제로 머신러닝을 할때 행렬곱을 최적화 할 때 캐시 히트율을 높이기 위해 행렬을 한번 transpose해주고 계산하기도 합니다.
