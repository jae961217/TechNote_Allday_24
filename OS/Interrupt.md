# 인터럽트(Interrupt)

### 인터럽트란?

- CPU가 프로그램을 실행하고 있을 때 예외상황이 발생한 경우, 현재 실행 중인 작업을 즉시 중단하고, 발생된 상황에 대한 우선 처리가 필요함을 CPU에게 알리는 것



### 인터럽트의 쓰임

다음과 같은 상황에서 인터럽트가 사용된다.

- **선점형 스케쥴러 구현**
  - 프로세스를 실행 중에 스케쥴러가 이를 중단시키고 다른 프로세스로 교체하기 위해 현재 프로세스 실행을 중단시킴
  - 그러기 위해서 스케쥴러 코드가 실행이 되어서 현 프로세스 실행을 중지시켜야 함

- **I/O Device와의 커뮤니케이션**
  - 저장매체에서 데이터 처리 완료시 프로세스를 깨워야 한다. (block state -> ready state, 프로세스 상태 변경)

- **예외 상황 핸들링**
  - CPU가 프로그램을 실행하고 있을 때, 0으로 나누기, 오버플로우 등의 예외상황이 발생할 경우, CPU가 해당 처리를 할 수 있도록 CPU에 알려줘야 함



### 인터럽트가 왜 필요할까?

- 만약 인터럽트 기능이 없었다면 CPU는 예외상황이 발생했는지 안했는지 지속적으로 체크를 해야 한다.(이를 Polling 이라고 한다, poll이 영어로 여론조사를 의미)

- Polling을 하는 시간에는 CPU가 원래 하던 일에 집중할 수가 없게 되어 많은 기능을 제대로 수행하지 못하는 단점이 있다.



### 인터럽트 종류

- **외부 인터럽트**

  주로 하드웨어에서 발생되는 이벤트(프로그램 외부)

  - 전원 이상 인터럽트: 정전, 파워 이상 등
  - 기계 착오 인터럽트: CPU의 기능적 오류
  - 외부 신호 인터럽트: 타이머에 의해 규정된 시간을 알리는 경우, Ctrl+Alt+Delete 등
  - 입출력 인터럽트: 입출력 Data의 오류나 이상현상 발생, 입출력장치가 데이터의 전송을 요구하거나 전송이 끝났음을 알릴 경우

- **내부 인터럽트**

  Trap이라고도 불리며, 주로 프로그램 내부에서 잘못된 명령이나 데이터를 사용할 때 발생

  - 0으로 나누기 발생
  - OverFlow, UnderFlow
  - 사용자 모드에서 허용되지 않은 명령 또는 공간 접근시

- **소프트웨어 인터럽트**

  프로그램 처리 중 명령의 요청에 의해 발생한 것 (대표적으로 SVC)

  - SVC(Supervisor Call)
    - 사용자가 프로그램을 실행시키거나 감시프로그램(Supervisor)을 호출하는 동작을 수행하는 경우
    - 복잡한 입출력 처리를 하는 경우



### 인터럽트 동작 순서

1. 인터럽트 발생
2. 프로그램 실행 중단
3. 현재의 프로그램 상태 보존 : PCB(Process Control Block), PC(Program Counter) -> *추후 정리!*
4. 인터럽트 처리루틴 실행: 인터럽트를 요청한 장치 식별
5. 인터럽트 서비스 루틴 실행
6. 상태복구 : 인터럽트 발생 시 저장해둔 PC(Program counter)를 다시 복구
7. 중단된 프로그램 실행 재개: PCB의 값을 이용하여 이전에 수행중이던 프로그램 재개



### 인터럽트 우선순위

여러 장치에서 인터럽트가 동시에 발생하거나 인터럽트 서비스 루틴 수행 중 다른 인터럽트가 발생한 경우 우선순위 판별 필요

1. 전원 이상
2. 기계 착오
3. 외부 신호
4. 입출력
5. 명령어 잘못
6. 프로그램 검사
7. SVC



### CPU가 예외상황을 받아들이는 방법(우선순위 판별방법)

**Polling** (소프트웨어적 방법)

- 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾고, 이에 해당하는 인터럽트 서비스 루틴을 수행
- 속도가 빠른 장치에 높은 등급을 부여
- 우선순위 변경이 쉬움
- 많은 인터럽트가 있을 경우 하드웨어적인 방법에 비해 우선순위 판단 속도가 느림
- 회로가 간단하고 별도의 하드웨어 필요없어 경제적
- Polling 주기가 짧으면 성능에 부담이 생기고, 주기가 길어지면 실시간성이 떨어짐

**Vectored Interrupt**(하드웨어적 방법)

- CPU와 인터럽트를 요청할 수 있는 장치 사이에 장치 번호에 해당하는 버스를 병렬이나 직렬로 연결하여 요청 장치의 번호를 CPU에 알리는 방식

- 장치 판별을 위한 별도의 프로그램 루틴이 없어 응답 속도가 빠름

- 회로가 복잡하고 융통성이 없으며 추가적인 하드웨어가 필요하므로 비경제적 

- 다음과 같이 두 가지 우선순위 부여 방식이 있음

1. Daisy Chain
   - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결
   - 우선 순위가 높은 장치를 상위에 두고 우선순위 차례대로 배치

2. 병렬 우선순위 부여 방식 
   - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결
   - 각 장치별 우선순위를 판별하기 위한 Mast register에 bit를 설정
   - Mask register상 우선순위가 높은 서비스 루틴 수행중 우선순위가 낮은 bit들을 비활성화 시킬 수 있음
   - 반대로 우선순위가 높은 인터럽트는 낮은 인터럽트 서비스 수행 중에도 우선 처리된다.

> 인터럽트 방식은 하드웨어로 지원을 받아야 하는 제약이 있지만, 폴링에 비해 신속하게 대응하는 것이 가능하다. 따라서 **'실시간 대응'**이 필요할 때는 필수적인 기능이다.

> 즉, 인터럽트는 발생시기를 예측하기 힘든 경우에 컨트롤러가 가장 빠르게 대응할 수 있는 방법이다.